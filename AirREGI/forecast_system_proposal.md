# コール件数予測システム提案書

## 1. エグゼクティブサマリー

コール件数の予測システムについて、週次予測と月次予測の2つのシナリオで実現性を検証しました。

### 検証結果

| 予測タイプ | MAE | 誤差率 | 実現性 |
|-----------|-----|--------|--------|
| 週次予測（水曜→翌週月〜金） | 48.9件 | 43.6% | ◎ 推奨 |
| 月次予測（20日→翌月1ヶ月） | 72.7件 | 38.6% | ○ 可能 |

**結論**: 両シナリオとも実現可能。週次予測の方が予測ホライズンが短く精度管理しやすいため推奨。

---

## 2. データ特性分析

### 2.1 基本統計（平日のみ）

| 統計量 | 値 |
|--------|-----|
| 分析対象日数 | 450日（平日のみ） |
| 平均コール件数 | 172.9件 |
| 標準偏差 | 108.1件 |
| 最小値 | 0件 |
| 最大値 | 757件 |

### 2.2 曜日別傾向

| 曜日 | 平均コール件数 | 特徴 |
|------|---------------|------|
| 月曜日 | 186.2件 | 週内で最多 |
| 火曜日 | 171.4件 | 平均的 |
| 水曜日 | 167.8件 | やや少なめ |
| 木曜日 | 170.1件 | 平均的 |
| 金曜日 | 171.1件 | 平均的 |

**知見**: 月曜日は週明けで問い合わせが集中する傾向。

### 2.3 自己相関分析

| ラグ | 相関係数 | 意味 |
|------|----------|------|
| 1日 | 0.850 | 前日との強い相関 |
| 5日（1週間） | 0.677 | 前週同曜日との中程度の相関 |
| 10日（2週間） | 0.529 | 2週前との弱〜中程度の相関 |
| 20日（1ヶ月） | 0.439 | 1ヶ月前との弱い相関 |

**知見**: 直近のデータが最も予測に有効。時間が経つほど相関が弱まる。

---

## 3. 予測シナリオ詳細

### 3.1 週次予測シナリオ

```
┌─────────────────────────────────────────────────────────────┐
│  今週                    │  翌週                           │
│  月  火  水  木  金  土日 │  月  火  水  木  金  土日       │
│  ●  ●  ●              │  ○  ○  ○  ○  ○              │
│  ←実績データ→          │  ←予測対象→                   │
└─────────────────────────────────────────────────────────────┘
● = 学習に使用する実績データ（水曜まで）
○ = 予測対象（翌週月〜金）
```

**運用フロー**:
1. 毎週水曜日の業務終了後にデータ取得
2. モデルを再学習（約1〜2分）
3. 翌週月〜金の日別コール件数を予測
4. 予測結果をシフト計画に反映

**精度**:
- MAE: 48.9件（実績平均112件）
- 予測誤差率: 約44%

### 3.2 月次予測シナリオ

```
┌─────────────────────────────────────────────────────────────┐
│  今月                              │  翌月                  │
│  1日 ... 20日  21日 ... 月末       │  1日 ... 月末          │
│  ●●●●●●●●●●               │  ○○○○○○○○○○○      │
│  ←実績データ→                    │  ←予測対象→          │
└─────────────────────────────────────────────────────────────┘
● = 学習に使用する実績データ（20日まで）
○ = 予測対象（翌月全日）
```

**運用フロー**:
1. 毎月20日の業務終了後にデータ取得
2. モデルを再学習（約2〜3分）
3. 翌月1ヶ月分の日別コール件数を予測
4. 予測結果を月間シフト計画に反映

**精度**:
- MAE: 72.7件（実績平均188件）
- 予測誤差率: 約39%

---

## 4. モデル更新の効果

### 4.1 更新あり vs 更新なし

| 更新方式 | MAE | 備考 |
|----------|-----|------|
| 更新あり | 61.4件 | 毎回最新データで再学習 |
| 更新なし | 106.9件 | 固定モデル（初期6ヶ月分） |
| **改善率** | **42.6%** | |

**知見**: モデルの定期更新により大幅な精度向上が見込める。トレンドの変化（キャンペーン、季節性）に追従できる。

### 4.2 推奨更新頻度

| 予測タイプ | 更新頻度 | 理由 |
|-----------|----------|------|
| 週次予測 | 毎週水曜 | 予測サイクルに合わせて |
| 月次予測 | 毎月20日 | 予測サイクルに合わせて |

---

## 5. 特徴量重要度

予測モデルにおいて重要な特徴量:

| 順位 | 特徴量 | 重要度 | 説明 |
|------|--------|--------|------|
| 1 | lag_1 | 0.569 | 前日のコール件数 |
| 2 | acc_get_cnt | 0.179 | アカウント取得数 |
| 3 | ma_5 | 0.057 | 5日移動平均 |
| 4 | lag_2 | 0.029 | 2日前のコール件数 |
| 5 | std_5 | 0.024 | 5日標準偏差（変動性） |

**知見**:
- **前日実績（lag_1）が最重要**: 予測の約57%を説明
- **アカウント取得数が有効**: 新規顧客からの問い合わせ予測に寄与
- **移動平均が補助的に機能**: トレンドの把握に有効

---

## 6. システム構成案

### 6.1 週次予測システム

```
┌──────────────────────────────────────────────────────────────┐
│                    週次予測システム                           │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  [データソース]     [予測エンジン]     [出力]                 │
│                                                              │
│  ┌─────────┐       ┌─────────┐       ┌─────────┐           │
│  │コール実績│──────→│  ML     │──────→│予測結果 │           │
│  │(〜水曜) │       │ モデル  │       │(翌週5日)│           │
│  └─────────┘       └─────────┘       └─────────┘           │
│       ↑                 ↑                  │               │
│  ┌─────────┐       ┌─────────┐       ┌─────────┐           │
│  │カレンダー│       │モデル   │       │シフト   │           │
│  │祝日情報 │       │更新     │       │計画     │           │
│  └─────────┘       │(毎週水) │       │システム │           │
│       ↑           └─────────┘       └─────────┘           │
│  ┌─────────┐                                                │
│  │外部データ│                                                │
│  │(GT, CM) │                                                │
│  └─────────┘                                                │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 6.2 処理フロー

```
毎週水曜 18:00
    │
    ▼
┌─────────────────┐
│ 1. データ取得    │  ← コール実績、カレンダー、外部データ
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 2. 特徴量生成    │  ← ラグ特徴量、移動平均等
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 3. モデル再学習  │  ← GradientBoosting (約1-2分)
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 4. 翌週予測実行  │  ← 月〜金の5日分
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 5. 結果出力      │  ← CSV/API/メール通知
└─────────────────┘
```

---

## 7. 精度向上の余地

現状の誤差率（約40%）を改善するための施策:

### 7.1 短期施策（効果: 中）

| 施策 | 期待効果 | 実装難易度 |
|------|----------|-----------|
| ハイパーパラメータ最適化 | 5-10%改善 | 低 |
| 追加特徴量（天気、イベント） | 5-10%改善 | 中 |
| アンサンブルモデル | 5-10%改善 | 中 |

### 7.2 中長期施策（効果: 高）

| 施策 | 期待効果 | 実装難易度 |
|------|----------|-----------|
| 時系列専用モデル（Prophet, LightGBM） | 10-20%改善 | 中 |
| 深層学習（LSTM, Transformer） | 10-20%改善 | 高 |
| 異常値検知・除外 | 5-10%改善 | 中 |

### 7.3 運用による改善

| 施策 | 期待効果 |
|------|----------|
| 予測結果のモニタリング | 異常の早期検知 |
| フィードバックループ | 継続的な精度改善 |
| 人間の知見の組み込み | イベント等の事前反映 |

---

## 8. 想定されるリスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| 急激なトレンド変化 | 予測精度低下 | 異常検知＋アラート |
| データ欠損・遅延 | 予測不能 | 前週値での代替予測 |
| 外部イベント（災害等） | 予測不能 | 手動調整機能 |
| モデル劣化 | 精度低下 | 定期的な精度監視 |

---

## 9. 推奨アプローチ

### フェーズ1: パイロット運用（1-2ヶ月）
- **週次予測**を先行導入
- 予測精度のモニタリング
- フィードバック収集

### フェーズ2: 本番運用（3ヶ月目〜）
- 精度改善施策の実施
- 月次予測の追加検討
- シフト計画システムとの連携

### フェーズ3: 高度化（6ヶ月目〜）
- 深層学習モデルの検討
- 自動異常検知
- ダッシュボード構築

---

## 10. 結論

| 項目 | 評価 |
|------|------|
| 技術的実現性 | ◎ 高い |
| データ量 | ○ 十分（約2年分） |
| 予測精度（週次） | ○ 実用レベル（MAE 49件） |
| 予測精度（月次） | △ 改善余地あり（MAE 73件） |
| モデル更新効果 | ◎ 42%改善 |

**最終推奨**:
1. まず**週次予測**からスタート
2. 運用しながら精度改善
3. 安定したら月次予測を追加検討

---

## 付録: 生成ファイル一覧

| ファイル | 説明 |
|----------|------|
| `forecast_feasibility_study.py` | 実現性検証スクリプト |
| `weekly_backtest_results.csv` | 週次予測バックテスト結果 |
| `monthly_backtest_results.csv` | 月次予測バックテスト結果 |
